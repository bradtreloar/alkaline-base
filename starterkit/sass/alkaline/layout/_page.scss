


$admin-toolbar-height: 39px;
$admin-toolbar-tray-height: 40px;

$top-bar-height: 48px;
$top-bar-z-index: 1000;


@mixin alkaline-page {
  .dialog-off-canvas-main-canvas {
    height: 100%;
  }

  div.page {
    height: 100%;
    padding: $top-bar-height 0 0 0;

    main {
      flex-grow: 1;
    }
  }

  @include tda-admin-layer;
  @include tda-header-layer;
  @include tda-lead-layer;
  @include tda-main-layer;
  @include tda-footer-layer;
  @include tda-boilerplate-layer;
}


@mixin tda-admin-layer {
  .layer.admin {
    position: relative;

    .region {
      &.content-width {
        margin: 0 auto;
        max-width: $global-width;
      }
    }
  }
}


@mixin tda-header-super-region {
  display: flex;
  flex-direction: row;
  flex-grow: 1;
  height: 100%;
  justify-content: space-between;
}


@mixin tda-header-region {
  display: flex;
  flex-direction: row;
  height: 100%;

  .block {
    align-items: center;
    display: flex;
    height: 100%;
  }
}


@mixin tda-navbar-super-region {
  background: inherit;
  color: inherit;
  display: flex;
  flex-direction: column;
  position: fixed;
  right: 0;
  z-index: $top-bar-z-index - 1; // under the header

  // @bug this rule causes dropdown submenus to be hidden
  // overflow-x: hidden;

  & {
    width: 0;
    pointer-events: none;
  }

  &.active {
    width: 320px;
    pointer-events: all;
  }

  // The height of the navbar is the difference between the top bar(s) and
  // the viewport height
  $difference: $top-bar-height;
  height: calc(100% - #{$difference});
  top: $difference;

  body.toolbar-horizontal &,
  body.toolbar-vertical & {
    $difference: $top-bar-height + $admin-toolbar-height;;
    height: calc(100% - #{$difference});
    top: $difference;
  }

  body.toolbar-horizontal.toolbar-tray-open & {
    $difference: $top-bar-height + $admin-toolbar-height + $admin-toolbar-tray-height;
    height: calc(100% - #{$difference});
    top: $difference;
  }

  // Convert to a header region.
  @include breakpoint(large) {
    flex-direction: row;
    height: 100% !important;
    justify-content: flex-end;
    pointer-events: all;
    position: static;
    width: auto;
    z-index: $top-bar-z-index + 1; // above the header
  }
}


@mixin tda-navbar-region {

  @include breakpoint(large) {
    // Convert to a header region.
    @include tda-header-region;
    justify-content: flex-end;
  }
}


@mixin tda-header-layer {
  .layer.header {
    width: 100%;

    &.fixed {
      position: fixed;
      // position: absolute; //@debug
      top: 0;
      transition: top 300ms ease;
      z-index: $top-bar-z-index;

      body.toolbar-horizontal &,
      body.toolbar-vertical & {
        padding-top: 39px;
      }

      body.toolbar-horizontal.toolbar-tray-open & {
        padding-top: 79px;
      }
    }

    // wrapper
    > div {
      background: inherit;
      height: $top-bar-height;
      display: flex;
      justify-content: space-between;
      margin: 0 auto;
      max-width: map-get($breakpoints, large);
      position: relative;
    }

    .super-region {
      &.header {
        @include tda-header-super-region;
      }

      &.navbar {
        @include tda-navbar-super-region;

        > .region {
          background: inherit;

          // Navbar blocks need to inherit the super-region's background color
          > .block {
            background: inherit;
          }
        }
      }
    }

    .region {
      &.header {
        @include tda-header-region;
      }

      &.navbar {
        @include tda-navbar-region;
      }

      &.buttons {
        @include tda-header-region;
        flex: none;

        @include breakpoint (large) {
          display: none;
        }
      }
    }
  }
}


@mixin tda-lead-layer {
  .layer.lead {
    position: relative;

    .block {
      padding: 0 $global-margin;
    }

    &.full-page {
      height: 100%;

      .region {
        height: 100%;
      }

      .block {
        height: 100%;

        > div {
          height: 100%;
        }
      }
    }

    .region {
      &.content-width {
        margin: 0 auto;
        max-width: $global-width;
      }
    }
  }
}


@mixin tda-main-layer {
  .layer.main {
    margin: 0 0 (2 * $global-margin);

    .block {
      padding: 0 $global-margin;
    }

    .page-title-block {
      margin-top: (3 * $global-margin);
      margin-bottom: (3 * $global-margin);
    }
  }

  #main-content {
    position: relative;
    top: -$top-bar-height;

    body.toolbar-horizontal &,
    body.toolbar-vertical & {
      top: -($top-bar-height + 39px);
    }

    body.toolbar-horizontal.toolbar-tray-open & {
      top: -($top-bar-height + 79px);
    }
  }
}


@mixin tda-footer-layer {
  .layer.footer {
    margin: $global-margin 0 0 0;
    padding: 0 $global-margin;

    > div {
      margin: 0 auto;
      max-width: map-get($breakpoints, large);
    }

    .region {
      justify-content: space-between;
    }

    .block {
      h2 {
        margin: $global-margin 0;
      }
    }
  }
}


@mixin tda-boilerplate-layer {
  .layer.boilerplate {
    padding: (2 * $global-margin) 0 $global-margin;

    > div {
      margin: 0 auto;
      max-width: map-get($breakpoints, large);
    }

    .region {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .block {
      // @todo move this to component stylesheet
      text-align: center;
      font-size: 0.85em;
      font-weight: bold;
      padding: 0 $global-margin;
      text-transform: uppercase;
    }
  }
}


// @include alkaline-page;
